<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeQL Analysis Dashboard - WKND</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 20px; }
        .chart-container { background: white; border-radius: 6px; padding: 15px; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        .severity-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .severity-critical { background: #ff5252; color: white; }
        .severity-high { background: #ff9100; color: white; }
        .severity-medium { background: #ffb300; color: black; }
        .severity-low { background: #7cb342; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { background: #f8f8f8; }
        .issue-row:hover { background: #f5f5f5; }
        .file-path { font-size: 12px; color: #666; }
        #filter-container { margin-bottom: 20px; }
        select, input { padding: 8px; margin-right: 10px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CodeQL Analysis Dashboard for WKND Project</h1>
        
        <div id="filter-container">
            <select id="severity-filter">
                <option value="all">All Severities</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
            <input type="text" id="path-filter" placeholder="Filter by file path">
        </div>
        
        <div class="dashboard-grid">
            <div class="chart-container">
                <h3>Issues by Severity</h3>
                <canvas id="severityChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Issues by Category</h3>
                <canvas id="categoryChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Top Files with Issues</h3>
                <canvas id="filesChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Issues Trend</h3>
                <canvas id="trendChart"></canvas>
            </div>
        </div>
        
        <h2>Detailed Issues</h2>
        <table id="issues-table">
            <thead>
                <tr>
                    <th>Severity</th>
                    <th>Issue</th>
                    <th>File</th>
                    <th>Line</th>
                </tr>
            </thead>
            <tbody id="issues-body">
                <!-- Issues will be populated here by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        // This is a placeholder - the actual data would come from parsing the SARIF files
        const mockData = {
            severityCounts: {
                critical: 2,
                high: 5,
                medium: 8,
                low: 12
            },
            categories: {
                'Security': 10,
                'Performance': 7,
                'Maintainability': 6,
                'Correctness': 4
            },
            topFiles: {
                'ui.frontend/src/main/webpack/site/main.js': 4,
                'core/src/main/java/com/adobe/aem/guides/wknd/core/service/impl/NavigationServiceImpl.java': 3,
                'ui.apps/src/main/content/jcr_root/apps/wknd/components/form/button/button.js': 3
            },
            trend: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                data: [28, 24, 20, 18, 15]
            },
            issues: [
                { severity: 'critical', description: 'Hardcoded credential in source code', file: 'ui.frontend/src/main/webpack/site/main.js', line: 42 },
                { severity: 'high', description: 'Unvalidated user input used in DOM manipulation', file: 'ui.apps/src/main/content/jcr_root/apps/wknd/components/form/button/button.js', line: 23 },
                // More issues would be populated from SARIF data
            ]
        };

        // Create charts using Chart.js
        window.onload = function() {
            // Severity Chart
            new Chart(document.getElementById('severityChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(mockData.severityCounts).map(s => s.charAt(0).toUpperCase() + s.slice(1)),
                    datasets: [{
                        data: Object.values(mockData.severityCounts),
                        backgroundColor: ['#ff5252', '#ff9100', '#ffb300', '#7cb342']
                    }]
                }
            });

            // Category Chart
            new Chart(document.getElementById('categoryChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(mockData.categories),
                    datasets: [{
                        data: Object.values(mockData.categories),
                        backgroundColor: '#4285f4'
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Files Chart
            new Chart(document.getElementById('filesChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(mockData.topFiles).map(f => f.split('/').pop()),
                    datasets: [{
                        data: Object.values(mockData.topFiles),
                        backgroundColor: '#0f9d58'
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    const index = tooltipItems[0].dataIndex;
                                    return Object.keys(mockData.topFiles)[index];
                                }
                            }
                        }
                    }
                }
            });

            // Trend Chart
            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: mockData.trend.labels,
                    datasets: [{
                        label: 'Total Issues',
                        data: mockData.trend.data,
                        borderColor: '#db4437',
                        tension: 0.1
                    }]
                }
            });

            // Populate issues table
            const tableBody = document.getElementById('issues-body');
            mockData.issues.forEach(issue => {
                const row = document.createElement('tr');
                row.className = 'issue-row';
                
                const severityCell = document.createElement('td');
                const badge = document.createElement('span');
                badge.className = `severity-badge severity-${issue.severity}`;
                badge.textContent = issue.severity.charAt(0).toUpperCase() + issue.severity.slice(1);
                severityCell.appendChild(badge);
                
                const descCell = document.createElement('td');
                descCell.textContent = issue.description;
                
                const fileCell = document.createElement('td');
                const fileText = document.createElement('span');
                fileText.className = 'file-path';
                fileText.textContent = issue.file;
                fileCell.appendChild(fileText);
                
                const lineCell = document.createElement('td');
                lineCell.textContent = issue.line;
                
                row.appendChild(severityCell);
                row.appendChild(descCell);
                row.appendChild(fileCell);
                row.appendChild(lineCell);
                
                tableBody.appendChild(row);
            });
        };
    </script>
</body>
</html>